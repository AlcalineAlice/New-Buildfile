
////////////////////////////////////////////////////
//                                                //
// Disassembled with Nintenlord's Event Assembler //
// Version: 11.1.0.0                              //
// Game: FE8                                      //
// File: celadon.event_assembler.gba              //
// Offset: $10010B0                               //
//                                                //
////////////////////////////////////////////////////


SlotMachine_Main:
CHECK_MONEY 
SVAL s7 1000
BLT 50 sC s0 // If less than 1000g, exit 
TutText(PlaySlotsText)
SVAL 0x7 0x1
BNE 0x63 0xC 0x7 // If not yes, then exit 
UNCM(0x7FFF, 1) // Hide current unit 
// hide party 


CHECK_COORDS 0x7FFF
SADD rB rC r0 
CALL ConvertFromMemSlotBCoord
CHECK_CHAPTER_NUMBER
SADD r2 rC r0 
Write_Byte(CurrentChapter)


FADI 33
LOMA SlotMachineCh
ShowMap
CALL SlotMachine_Start 
// clean up 
FADI 33
CLEE 0x0

// restore party from being hidden 

Read_Byte(CurrentChapter)
SADD r2 rC r0 
LOADMAP (-1) // fixed version of LOMA 
// just in case I copy Stan's EA folder again I guess 
//FADU 33 
CHECK_COORDS 0x7fff
SADD sB sC s0 
CALL CamSlotB
//ASMC 0x08019FA1   //UpdateUnitMapAndVision
//ASMC  0x0801A1A1   //UpdateTrapHiddenStates
//ASMC  0x080271a1   //@SMS_UpdateFromGameData
//ASMC  0x08019c3d   //@UpdateGameTilesGraphics
ASMC TrapRework_NewUpdateAllLightRunes

UNCR(0x7fff, 1) // unhide 
GOTO 0x63 
LABEL 50
TutText(InsufficientFundsText)

LABEL 0x63 
ShowMap



NoFade 
ENDA 

// maybe a sleeping Prof Oak? 

SlotMachine_Start:




COUNTER_SET 0x1 0x5
EVBIT_MODIFY 0x1
ENUT 0x84
SVAL 0xB 0x30005
DISA_IF 0xFFFE
SVAL 0xB 0x30007
DISA_IF 0xFFFE
SVAL 0xB 0x30009
DISA_IF 0xFFFE
SVAL 0xB 0x50005
DISA_IF 0xFFFE
SVAL 0xB 0x50007
DISA_IF 0xFFFE
SVAL 0xB 0x50009
DISA_IF 0xFFFE
SVAL 0xB 0x70005
DISA_IF 0xFFFE
SVAL 0xB 0x70007
DISA_IF 0xFFFE
SVAL 0xB 0x70009
DISA_IF 0xFFFE
GOTO 0x9000
LABEL 0x9000
SVAL 0x2 0xD0
RANDOMNUMBER 0xA
SADD 0xC23
RANDOMNUMBER 0xA
SADD 0xC24
RANDOMNUMBER 0xA
SADD 0xC25
RANDOMNUMBER 0xA
SADD 0xC26
RANDOMNUMBER 0xA
SADD 0xC27
RANDOMNUMBER 0xA
SADD 0xC28
RANDOMNUMBER 0xA
SADD 0xC29
RANDOMNUMBER 0xA
SADD 0xC2A
RANDOMNUMBER 0xA
SADD 0xC2B
GOTO 0x9015
LABEL 0x9010
CALL SlotMachine_1
SVAL 0x2 0xD0
RANDOMNUMBER 0xA
SADD 0xC23
RANDOMNUMBER 0xA
SADD 0xC27
RANDOMNUMBER 0xA
SADD 0xC2B
LABEL 0x9015
CALL SlotMachine_2
CALL SlotMachine_3
SVAL 0x2 0xD0
RANDOMNUMBER 0x8
SADD 0xC25
RANDOMNUMBER 0x8
SADD 0xC26
RANDOMNUMBER 0x8
SADD 0xC29
CALL SlotMachine_4
CALL SlotMachine_5
SVAL 0x2 0xD0
RANDOMNUMBER 0x7
SADD 0xC24
RANDOMNUMBER 0x7
SADD 0xC28
RANDOMNUMBER 0x7
SADD 0xC2A
COUNTER_SUBTRACT 0x1 0x1
CALL SlotMachine_6
COUNTER_CHECK 0x1
SVAL 0x7 0x0
BGT 0x9010 0xC 0x7
GOTO 0x9050

LABEL 0x9050
UNCR(0x7FFF, 0x42) // Refresh unit 
CALL SlotMachine_CheckRewards
ENUF 0x84
NoFade 
ENDA

SlotMachine_Common:
SADD 0x71
COUNTER_CHECK 0x1
SVAL 0x7 0x5
BGT 0x9050 0xC 0x7
STAL 1
COUNTER_CHECK 0x1
SVAL 0x7 0x4
BGT 0x9050 0xC 0x7
STAL 2
COUNTER_CHECK 0x1
SVAL 0x7 0x3
BGT 0x9050 0xC 0x7
RANDOMNUMBER 0x1
SVAL 0x7 0x0
BGT 0x9015 0xC 0x7
STAL 2
LABEL 0x9015
COUNTER_CHECK 0x1
SVAL 0x7 0x2
BGT 0x9050 0xC 0x7
STAL 3
RANDOMNUMBER 0x1
SVAL 0x7 0x0
BGT 0x9025 0xC 0x7
COUNTER_CHECK 0x1
SVAL 0x7 0x1
BGT 0x9050 0xC 0x7
STAL 4
LABEL 0x9025
LABEL 0x9050
SADD 0x17
EVBIT_T 0x7
ENDA



SlotMachine_1:
SADD 0x42
SPAWN_ENEMY 0xFFFD [5,4]
SADD 0x52
SPAWN_ENEMY 0xFFFD [5,6]
SADD 0x82
SPAWN_ENEMY 0xFFFD [7,4]
SADD 0x62
SPAWN_ENEMY 0xFFFD [7,6]
SADD 0xA2
SPAWN_ENEMY 0xFFFD [9,4]
SADD 0x92
SPAWN_ENEMY 0xFFFD [9,6]
ENUN
CALL SlotMachine_Common
SADD 0x42
DISA 0xFFFD
SADD 0x52
DISA 0xFFFD
SADD 0x62
DISA 0xFFFD
SADD 0x82
DISA 0xFFFD
SADD 0x92
DISA 0xFFFD
SADD 0xA2
DISA 0xFFFD
EVBIT_T 0x7
ENDA

SlotMachine_2:
SADD 0x32
SPAWN_ENEMY 0xFFFD [5,3]
SADD 0x42
SPAWN_ENEMY 0xFFFD [5,5]
SADD 0x52
SPAWN_ENEMY 0xFFFD [5,7]
SADD 0x72
SPAWN_ENEMY 0xFFFD [7,3]
SADD 0x82
SPAWN_ENEMY 0xFFFD [7,5]
SADD 0x62
SPAWN_ENEMY 0xFFFD [7,7]
SADD 0xB2
SPAWN_ENEMY 0xFFFD [9,3]
SADD 0xA2
SPAWN_ENEMY 0xFFFD [9,5]
SADD 0x92
SPAWN_ENEMY 0xFFFD [9,7]
CALL SlotMachine_Common
ENUN
SADD 0x32
DISA 0xFFFD
SADD 0x42
DISA 0xFFFD
SADD 0x52
DISA 0xFFFD
SADD 0x62
DISA 0xFFFD
SADD 0x82
DISA 0xFFFD
SADD 0x72
DISA 0xFFFD
SADD 0x92
DISA 0xFFFD
SADD 0xA2
DISA 0xFFFD
SADD 0xB2
DISA 0xFFFD
EVBIT_T 0x7
ENDA









SlotMachine_3:
SADD 0x32
SPAWN_ENEMY 0xFFFD [5,4]
SADD 0x42
SPAWN_ENEMY 0xFFFD [5,6]
SADD 0x72
SPAWN_ENEMY 0xFFFD [7,4]
SADD 0x82
SPAWN_ENEMY 0xFFFD [7,6]
SADD 0xB2
SPAWN_ENEMY 0xFFFD [9,4]
SADD 0xA2
SPAWN_ENEMY 0xFFFD [9,6]
ENUN
CALL SlotMachine_Common
SADD 0x32
DISA 0xFFFD
SADD 0x42
DISA 0xFFFD
SADD 0x72
DISA 0xFFFD
SADD 0x82
DISA 0xFFFD
SADD 0xB2
DISA 0xFFFD
SADD 0xA2
DISA 0xFFFD
EVBIT_T 0x7
ENDA









SlotMachine_4:
SADD 0x32
SPAWN_ENEMY 0xFFFD [5,5]
SADD 0x42
SPAWN_ENEMY 0xFFFD [5,7]
SADD 0x52
SPAWN_ENEMY 0xFFFD [5,3]
SADD 0x72
SPAWN_ENEMY 0xFFFD [7,5]
SADD 0x82
SPAWN_ENEMY 0xFFFD [7,7]
SADD 0x62
SPAWN_ENEMY 0xFFFD [7,3]
SADD 0xB2
SPAWN_ENEMY 0xFFFD [9,5]
SADD 0xA2
SPAWN_ENEMY 0xFFFD [9,7]
SADD 0x92
SPAWN_ENEMY 0xFFFD [9,3]
ENUN
CALL SlotMachine_Common
SADD 0x32
DISA 0xFFFD
SADD 0x42
DISA 0xFFFD
SADD 0x52
DISA 0xFFFD
SADD 0x62
DISA 0xFFFD
SADD 0x82
DISA 0xFFFD
SADD 0x72
DISA 0xFFFD
SADD 0x92
DISA 0xFFFD
SADD 0xA2
DISA 0xFFFD
SADD 0xB2
DISA 0xFFFD
EVBIT_T 0x7
ENDA




SlotMachine_5:
SADD 0x32
SPAWN_ENEMY 0xFFFD [5,6]
SADD 0x52
SPAWN_ENEMY 0xFFFD [5,4]
SADD 0x72
SPAWN_ENEMY 0xFFFD [7,6]
SADD 0x62
SPAWN_ENEMY 0xFFFD [7,4]
SADD 0xB2
SPAWN_ENEMY 0xFFFD [9,6]
SADD 0x92
SPAWN_ENEMY 0xFFFD [9,4]
ENUN
CALL SlotMachine_Common
SADD 0x32
DISA 0xFFFD
SADD 0x52
DISA 0xFFFD
SADD 0x62
DISA 0xFFFD
SADD 0x72
DISA 0xFFFD
SADD 0x92
DISA 0xFFFD
SADD 0xB2
DISA 0xFFFD
EVBIT_T 0x7
ENDA




SlotMachine_6:
SADD 0x32
SPAWN_ENEMY 0xFFFD [5,7]
SADD 0x42
SPAWN_ENEMY 0xFFFD [5,3]
SADD 0x52
SPAWN_ENEMY 0xFFFD [5,5]
SADD 0x72
SPAWN_ENEMY 0xFFFD [7,7]
SADD 0x82
SPAWN_ENEMY 0xFFFD [7,3]
SADD 0x62
SPAWN_ENEMY 0xFFFD [7,5]
SADD 0xB2
SPAWN_ENEMY 0xFFFD [9,7]
SADD 0xA2
SPAWN_ENEMY 0xFFFD [9,3]
SADD 0x92
SPAWN_ENEMY 0xFFFD [9,5]
ENUN
CALL SlotMachine_Common
COUNTER_CHECK 0x1
SVAL 0x7 0x1
BLT 0x9050 0xC 0x7
SVAL 0xB 0x70005
DISA_IF 0xFFFE
SVAL 0xB 0x50005
DISA_IF 0xFFFE
SVAL 0xB 0x30005
DISA_IF 0xFFFE
SVAL 0xB 0x70007
DISA_IF 0xFFFE
SVAL 0xB 0x50007
DISA_IF 0xFFFE
SVAL 0xB 0x30007
DISA_IF 0xFFFE
SVAL 0xB 0x30009
DISA_IF 0xFFFE
SVAL 0xB 0x50009
DISA_IF 0xFFFE
SVAL 0xB 0x70009
DISA_IF 0xFFFE
LABEL 0x9050
EVBIT_T 0x7
ENDA

SlotMachine_CheckRewards:
SVAL 0xB 0x30005
CHECK_CLASS 0xFFFE
SADD 0xC3
SVAL 0xB 0x30007
CHECK_CLASS 0xFFFE
SADD 0xC4
SVAL 0xB 0x30009
CHECK_CLASS 0xFFFE
SADD 0xC5
SVAL 0xB 0x50005
CHECK_CLASS 0xFFFE
SADD 0xC6
SVAL 0xB 0x50007
CHECK_CLASS 0xFFFE
SADD 0xC8
SVAL 0xB 0x50009
CHECK_CLASS 0xFFFE
SADD 0xC9
SVAL 0xB 0x70005
CHECK_CLASS 0xFFFE
SADD 0xCA
SVAL 0xB 0x50007
CHECK_CLASS 0xFFFE
SADD 0xC1
SVAL 0xB 0x70009
CHECK_CLASS 0xFFFE
SADD 0xC2
SMUL 0x454
SDIV 0x344
BNE 0x9000 0x3 0x4
SADD 0x34
CALL SlotMachine_Awards
LABEL 0x9000
SMUL 0xA64
SDIV 0x344
BNE 0x9001 0x3 0x4
CALL SlotMachine_Awards
LABEL 0x9001
SMUL 0x824
SDIV 0x344
BNE 0x9002 0x3 0x4
CALL SlotMachine_Awards
LABEL 0x9002
SMUL 0xA84
SDIV 0x544
BNE 0x9003 0x5 0x4
SADD 0x54
CALL SlotMachine_Awards
LABEL 0x9003
SMUL 0xA14
SDIV 0x244
BNE 0x9004 0x2 0x4
SADD 0x42
CALL SlotMachine_Awards
LABEL 0x9004
SMUL 0x924
SDIV 0x544
BNE 0x9005 0x5 0x4
SADD 0x54
CALL SlotMachine_Awards
LABEL 0x9005
SMUL 0x684
SDIV 0x944
BNE 0x9006 0x5 0x4
SADD 0x94
CALL SlotMachine_Awards
GOTO 0x9045
LABEL 0x9006
STAL 150

LABEL 0x9045 
EVBIT_T 0x7
ENDA


SlotMachine_Awards:
SADD 0x4C
SVAL 0x7 0x50
BNE 0x9000 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x7C
GIVEITEMTO 0x7FFF
LABEL 0x9000
SADD 0x4C
SVAL 0x7 0x77
BNE 0x9001 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x7B
GIVEITEMTO 0x7FFF
LABEL 0x9001
SADD 0x4C
SVAL 0x7 0x5F
BNE 0x9002 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0xB4
GIVEITEMTO 0x7FFF
LABEL 0x9002
SADD 0x4C
SVAL 0x7 0x41
BNE 0x9003 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x27
GIVEITEMTO 0x7FFF
LABEL 0x9003
SADD 0x4C
SVAL 0x7 0x6C
BNE 0x9004 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x35
GIVEITEMTO 0x7FFF
LABEL 0x9004
SADD 0x4C
SVAL 0x7 0x79
BNE 0x9005 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x73
GIVEITEMTO 0x7FFF
LABEL 0x9005
SADD 0x4C
SVAL 0x7 0x15
BNE 0x9006 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x9
GIVEITEMTO 0x7FFF
CALL 0x591F40
SVAL 0x3 0x17
GIVEITEMTO 0x2
CALL 0x591F40
SVAL 0x3 0x3
GIVEITEMTO 0x2
LABEL 0x9006
SADD 0x4C
SVAL 0x7 0x4D
BNE 0x9007 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0x5B
GIVEITEMTO 0x7FFF
LABEL 0x9007
SADD 0x4C
SVAL 0x7 0x7A
BNE 0x9008 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0xB7
GIVEITEMTO 0x7FFF
LABEL 0x9008
SADD 0x4C
SVAL 0x7 0x51
BNE 0x9009 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0xA8
GIVEITEMTO 0x7FFF
LABEL 0x9009
SADD 0x4C
SVAL 0x7 0x34
BNE 0x900A 0xC 0x7
SADD 0x34
CALL 0x591F40
SVAL 0x3 0xB5
GIVEITEMTO 0x7FFF
LABEL 0x900A
LABEL 0x9050
EVBIT_T 0x7
ENDA


